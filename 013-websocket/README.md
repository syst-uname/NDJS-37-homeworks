### Realtime-взаимодействие с сервером, протокол websocket на примере функционала обсуждения книг в комментариях

#### Предварительные данные 

Комментарии доступны как для каждой книги (по конкретному id книги), так и для всей библиотеки в целом на главной странице приложения (ключ 'index'). Комментарии сохраняются в БД и выводятся в соответствующих разделах. 

Тестовые данные создаются в БД с помощью скрипта `./data/mongo/init-db.js`. 

Пример комментариев на главной странице библиотеки (комментарии текущего пользователя выводятся в диалоге по правому краю):

![Комментарии на главной странице](README/01.01%20Комментарии%20на%20главной%20странице.png)

#### Ввод комментария на главной странице 

Открыты два окна `/view` под разными пользователями (JD слева и Admin справа). В левом окне введен текст для нового комментария:
![Ввод нового комментария](README/02.01%20Новый%20комментарий.png)

После отправки текста в левом окне новый комментарий сразу появляется у обоих пользователей: 
![Отправка нового комментария](README/02.02%20Новый%20комментарий.%20Отправка.png)

При этом, если открыть в правом окне комментарии к любой книге (например `/view/book/1`), то там только что введенного сообщения не будет:
![Проверка на другом окне](README/02.03%20Новый%20комментарий.%20Проверка%20в%20другом%20окне.png)

#### Ввод комментария для книги 

Добавим в левой нижней части еще одно окно для пользователя JD и откроем ту же книгу `/view/book/1`. В левой верхней части все еще открыта главная страница `/view` под пользователем JD. В правой части тоже открыта книга `/view/book/1`, но под пользователем Admin. Введен текст нового комментария: 
![Комментарий к книге](README/03.01%20Комментарий%20к%20книге.png)

После отправки комментария к книге новое сообщение сразу появляется для самого пользователя Admin (справа) и JD (слева снизу). На странице комментариев к библиотеке (слева сверху) новых комментариев не появилось (как и во всех других книгах). 
![Комментарий к книге](README/03.02%20Комментарий%20к%20книге.%20Отправка.png)

#### Публикация приложения 

Образы приложений library и counter опубликованы на https://hub.docker.com/repository/docker/u0name/013-websocket/general

Файл docker-compose.yml:
```
services:

  storage_redis:
    image: redis
    volumes:
      - ./data/redis:/data

  counter:
    image: u0name/013-websocket:counter-v1.0.0
    ports:
      - 3001:3001
    environment:
      - PORT=3001
      - REDIS_URL=redis://storage_redis
    depends_on:
      - storage_redis

  storage_mongo:
    image: mongo 
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_DATABASE: library
    volumes:
      - ./data/mongo/init-db.js:/docker-entrypoint-initdb.d/init-db.js:ro 

  library:
    image: u0name/013-websocket:library-v1.0.0
    ports:
      - 80:3002
    environment:
      - PORT=3002
      - COUNTER_URL=http://counter:3001
      - MONGO_URL=mongodb://storage_mongo:27017/library
    env_file:
      - ./library/.env      
    depends_on:
      - counter
      - storage_mongo 
```